#!/bin/bash
set -euo pipefail

for arg in "$@"; do
    [[ "$arg" == '-h' || "$arg" == '--help' ]] && cat << EOF && exit
Usage: md5rename FILE
Rename a file to its md5 hash followed by its extension.
EOF
done

inf=${1:-}
if [ -z "$inf" ] || [ ! -e "$inf" ]; then
    echo "File not found: '$inf'" >&2
    exit 1
fi

md5=$(md5sum "$inf" | awk '{print $1}')
ext=$(basename "$inf" | awk -F. '$1 != "" && NF > 1 || $1 == "" && NF > 2 {print $NF}')

if [ -n "$ext" ]; then
    fout="$md5.$ext"
else
    fout="$md5"
fi

mv -v "$inf" "$fout"
